<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>User Form</title>
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Include Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- Include Bootstrap CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 id="formTitle" class="my-4">Add User</h1>
      <form id="userForm">
        <input type="hidden" id="userId" name="userId" />
        <div class="mb-3">
          <label for="name" class="form-label">Name:</label>
          <input
            type="text"
            class="form-control"
            id="name"
            name="name"
            required
          />
        </div>
        <div class="mb-3">
          <label for="dateOfBirth" class="form-label">Date of Birth:</label>
          <input
            type="date"
            class="form-control"
            id="dateOfBirth"
            name="dateOfBirth"
            required
          />
        </div>
        <div class="mb-3">
          <label for="phone" class="form-label">Phone:</label>
          <input
            type="tel"
            class="form-control"
            id="phone"
            name="phone"
            required
          />
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>

    <script>
      // const host = "https://prospine.id:8443";
      const host = "http://localhost:8585";

      $(document).ready(function () {
        var urlParams = new URLSearchParams(window.location.search);
        var userId = urlParams.get("id");

        if (userId) {
          // Edit user scenario
          $("#formTitle").text("Edit User");

          // Fetch the user details and populate the form
          $.ajax({
            type: "GET",
            url: `${host}/userById`,
            data: { id: userId },
            success: function (data) {
              $("#userId").val(data.id);
              $("#name").val(data.name);
              $("#dateOfBirth").val(data.dateOfBirth);
              $("#phone").val(data.phone);
            },
            error: function () {
              alert("Error fetching user details");
            },
          });
        }

        $("#userForm").submit(function (event) {
          event.preventDefault();

          var formData = {
            name: $("#name").val(),
            dateOfBirth: $("#dateOfBirth").val(),
            phone: $("#phone").val(),
            age: 2,
            height: 80,
            dadHeight: 160,
            momHeight: 150,
            gender: "M",
            notes: "test notes",
          };

          var ajaxUrl = userId
            ? `${host}/submitFormData/${userId}`
            : `${host}/submitFormData`;
          var ajaxMethod = userId ? "PUT" : "POST";

          $.ajax({
            type: ajaxMethod,
            url: ajaxUrl,
            data: JSON.stringify(formData),
            contentType: "application/json",
            success: function () {
              alert("User " + (userId ? "updated" : "added") + " successfully");
              window.location.href = "index.html";
            },
            error: function () {
              alert("Error " + (userId ? "updating" : "adding") + " user");
            },
          });
        });
      });
    </script>
  </body>
</html>
